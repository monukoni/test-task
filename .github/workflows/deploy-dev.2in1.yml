name: Deploy dev-2in1 environment
run-name: ${{ github.actor }} pushed new update
on:
    push:
        branches:
            - 'dev-2in1'
    workflow_dispatch:

jobs:
    deploy:
        runs-on: ubuntu-24.04
        steps:
          - uses: actions/checkout@v4
          - name: set up secrets
            run: |
                echo "${{ secrets.DOT_ENV_2IN1 }}" > .env
          - name: set up inventory.ini
            run: |
                echo "${{ secrets.INVENTORY_INI_2IN1 }}" > inventory.ini
          - name: set up ssh key
            run: |
                echo "${{ secrets.SSH_KEY }}" > ssh-key.pem
                chmod 400 ssh-key.pem
          - name: install Ansibles
            run: |
                sudo apt update
                sudo apt install software-properties-common
                sudo add-apt-repository --yes --update ppa:ansible/ansible
                sudo apt install ansible
          - name: deploy dev to cloud
            run: |
                set -a && source .env && set +a
                ansible-playbook -i inventory.ini ansible-setup.2in1.yml
            